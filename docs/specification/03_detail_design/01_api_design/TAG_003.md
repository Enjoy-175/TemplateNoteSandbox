# TAG_003 タグ作成API
- Method: POST
- Path: /api/tags
- 認証: 要（セッション必須）

## Input
- sessionUserId（UUID, 必須, セッションから取得, 例: "5b8e7e4a-4f21-4d0e-b72f-8d5a2d5c9f3b"）
- tagKey（文字列, 必須, 1〜16文字, 空白のみ不可, 例: "Status"）
- tagValue（文字列, 必須, 1〜16文字, 空白のみ不可, 例: "Open"）

## Validation Rule
- Rule V001: タグキー必須チェック
  - 対象: tagKey
  - 条件: null または 空文字 または 空白のみ
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグキーは必須です。"

- Rule V002: タグキー空白のみチェック
  - 対象: tagKey
  - 条件: 空白のみ
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグキーは空白のみは使用できません。"

- Rule V003: タグキー文字数チェック
  - 対象: tagKey
  - 条件: 文字数 > 16
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグキーは16文字以内で入力してください。"

- Rule V004: タグ値必須チェック
  - 対象: tagValue
  - 条件: null または 空文字 または 空白のみ
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグ値は必須です。"

- Rule V005: タグ値空白のみチェック
  - 対象: tagValue
  - 条件: 空白のみ
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグ値は空白のみは使用できません。"

- Rule V006: タグ値文字数チェック
  - 対象: tagValue
  - 条件: 文字数 > 16
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "タグ値は16文字以内で入力してください。"

- Rule V007: 正規化チェック
  - 対象: tagKey, tagValue
  - 条件: trim 後に空、または16文字超
  - 判定: NG
  - エラーコード: E-400-VALIDATION
  - メッセージ: "入力値が不正です。"

### チェック順序
1. V001 → NGなら終了
2. V002 → NGなら終了
3. V003 → NGなら終了
4. V004 → NGなら終了
5. V005 → NGなら終了
6. V006 → NGなら終了
7. V007 → NGなら終了
8. 全てOKなら次の処理へ

## Process
- Step 1: セッション認証
  - SessionUserInterceptor でセッション確認
  - NG: E-401-UNAUTHORIZED を返して終了

- Step 2: 入力バリデーション
  - Validation Rule を順に適用
  - NG: E-400-VALIDATION を返して終了

- Step 3: 入力正規化
  - tagKey/tagValue を trim
  - 空または16文字超過の場合は E-400-VALIDATION

- Step 4: 重複チェック & 登録
  - user_id + tag_key + tag_value の一意制約を確認
  - NG: E-409-TAG-DUPLICATE を返して終了
  - トランザクション開始
  - tags に insert
  - 失敗: ロールバックし E-500-DB

- Step 5: レスポンス生成
  - 作成したタグを返却
  - Location ヘッダに /api/tags/{id} を設定

## Output
### パターン1: 成功
- 型: JSON
- HTTP: 201
- 例:
  {
    "id": 10,
    "tagKey": "Status",
    "tagValue": "Open"
  }

### パターン2: Validation Error（例: V001）
- 型: JSON
- HTTP: 400
- 例:
  {
    "code": "E-400-VALIDATION",
    "message": "タグキーは必須です。",
    "details": [
      { "field": "tagKey", "message": "タグキーは必須です。" }
    ],
    "operation": "create",
    "tagId": null
  }

### パターン3: 業務エラー（重複）
- 型: JSON
- HTTP: 409
- 例:
  {
    "code": "E-409-TAG-DUPLICATE",
    "message": "同じタグが既に存在します。",
    "details": null,
    "operation": "create",
    "tagId": null
  }

### パターン4: 認証エラー
- 型: JSON
- HTTP: 401
- 例:
  {
    "code": "E-401-UNAUTHORIZED",
    "message": "セッションユーザーが見つかりません。",
    "details": null,
    "operation": "create",
    "tagId": null
  }

### パターン5: システムエラー
- 型: JSON
- HTTP: 500
- 例:
  {
    "code": "E-500-DB",
    "message": "システムエラーが発生しました。",
    "details": null,
    "operation": "create",
    "tagId": null
  }

## Error 定義
- E-400-VALIDATION
  - 発生条件: tagKey/tagValue のバリデーションNGまたは正規化失敗
  - Input例: tagKey = ""
  - 検出Step: Step 2 / Step 3
  - Output例: Output パターン2

- E-409-TAG-DUPLICATE
  - 発生条件: user_id + tag_key + tag_value の一意制約違反
  - Input例: tagKey = "Status", tagValue = "Open"（既存）
  - 検出Step: Step 4
  - Output例: Output パターン3

- E-401-UNAUTHORIZED
  - 発生条件: セッション未確立または期限切れ
  - 検出Step: Step 1
  - Output例: Output パターン4

- E-500-DB
  - 発生条件: DBアクセス例外
  - 検出Step: Step 4
  - Output例: Output パターン5

- E-500-UNEXPECTED
  - 発生条件: 予期しない例外
  - 検出Step: 全Step
  - Output例:
    {
      "code": "E-500-UNEXPECTED",
      "message": "予期しないエラーが発生しました。",
      "details": null,
      "operation": "create",
      "tagId": null
    }
